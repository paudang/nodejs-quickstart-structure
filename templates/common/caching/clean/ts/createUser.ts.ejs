import { User } from '@/domain/user';

import { UserRepository } from '@/infrastructure/repositories/UserRepository';
<%_ if (caching === 'Redis') { -%>
import cacheService from '@/infrastructure/caching/redisClient';
<%_ } else if (caching === 'Memory Cache') { -%>
import cacheService from '@/infrastructure/caching/memoryCache';
<%_ } -%>
import logger from '@/infrastructure/log/logger';

export default class CreateUser {
    constructor(private userRepository: UserRepository) {}

    async execute(name: string, email: string) {
        const user = new User(null, name, email);
        const savedUser = await this.userRepository.save(user);

        try {
            await cacheService.del('users:all');
            logger.info('Invalidated users:all cache');
        } catch (error) {
            logger.error('Cache error (del):', error);
        }

        return savedUser;
    }
}
