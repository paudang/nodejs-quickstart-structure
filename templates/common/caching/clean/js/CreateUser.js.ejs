const User = require('../domain/models/User');
const redis = require('../infrastructure/caching/redisClient');
const logger = require('../infrastructure/log/logger');

class CreateUser {
    constructor(userRepository) {
        this.userRepository = userRepository;
    }

    async execute(name, email) {
        const user = new User(null, name, email);
        const savedUser = await this.userRepository.save(user);

        try {
            await redis.del('users:all');
            logger.info('Invalidated users:all cache');
        } catch (error) {
            logger.error('Redis error (del):', error);
        }

        return savedUser;
    }
}

module.exports = CreateUser;
