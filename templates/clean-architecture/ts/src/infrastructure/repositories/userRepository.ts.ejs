import { User as UserEntity } from '@/domain/user';
import UserModel from '@/infrastructure/database/models/User';

export class UserRepository {
    async save(user: UserEntity): Promise<UserEntity> {
<%_ if (database === 'MongoDB') { -%>
        const newUser = await UserModel.create({ name: user.name, email: user.email });
        return { id: newUser._id.toString(), name: newUser.name, email: newUser.email };
<%_ } else if (database === 'None') { -%>
        const newUser = { id: String(UserModel.mockData.length + 1), name: user.name, email: user.email };
        UserModel.mockData.push(newUser);
        return newUser;
<%_ } else { -%>
        const newUser = await UserModel.create({ name: user.name, email: user.email });
        return { id: newUser.id, name: newUser.name, email: newUser.email };
<%_ } -%>
    }

    async getUsers(): Promise<UserEntity[]> {
<%_ if (database === 'MongoDB') { -%>
        const users = await UserModel.find();
        return users.map(user => ({
            id: user._id.toString(),
            name: user.name,
            email: user.email
        }));
<%_ } else if (database === 'None') { -%>
        return UserModel.mockData;
<%_ } else { -%>
        const users = await UserModel.findAll();
        return users.map(user => ({
            id: user.id,
            name: user.name,
            email: user.email
        }));
<%_ } -%>
    }
}
